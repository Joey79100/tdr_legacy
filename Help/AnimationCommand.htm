<HTML><HEAD><TITLE>TRNG - Animation Command </TITLE></HEAD>
<BODY TEXT=#000000 BGCOLOR=#FFFFC0 LINK=#0000FF ALINK=#0000FF VLINK=#000080> 
<BASEFONT SIZE=3>
<FONT COLOR=#FF0000>
<CENTER><H1>TRNG - Animation Command</H1></CENTER></FONT>
<B>This document is a short introduction to Animation command,  with some study in depth of TestPosition command and ENV_ITEM_TEST_POSITION condition.<BR>
<BR>
<FONT COLOR=#FF0080><H3>Summary</H3></FONT><A HREF="#LINK1">Introduction</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK2">Create a new animation with Wad Merger</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK3">Type an Animation script command</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK4">Add a NG AnimCommands to your custom animation</A> <BR>
<BR>
<A HREF="#LINK5">The TestPosition command</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK15">Relative Axis</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK16">Size of Lara</A> <BR>
<A HREF="#LINK17">The project Test Lara Position</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK19">Suggestions</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK18">Sample A - In front of right rear wheel of Jeep</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK22">Compute of ideal position</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK20">Sample B - In front of the back of Jeep</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK21">Self-Alignment feature</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK23">Sample C - In front of King Throne</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK24">To use multiple ENV conditions</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK25">Sample D - In front of Metal Gate</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK26">Double facing with TestPosition</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK27">Move the origin of Objects using MetaSequoia</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK28">Sample E - Lara in front to the cube</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK31">Facing for all sides</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK29">Sample F - Lara punchs a Baddy (Full working example)</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK30">Compute Ideal Position for Item in motion</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK32">The necessary to add new skills to Lara</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK33">The Custom Animation</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK34">How set a NG AnimCommand</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK35">How enhance the fighting sample</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK49">Create new non-shooting weapon</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK36">Sample G - Conditons to test the Room Geometry</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK37">Inner and Outside Corners</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK38">G1 - Inner Corner</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK39">G2 - Outside Corner</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK40">G3 - Height of Monkey Ceiling</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK41">G4 - An HandHold in Front Wall</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK42">G5 - Lara monkey has over her a climb wall</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK43">G6 - Lara monkey has over and back her a climb wall</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK44">G7 - Lara hanged on height wall</A> <BR>
<BR>
<A HREF="#LINK48">Trouble shooting</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK46">Issue about State IDs</A>  <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK47">The most common problems</A> <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#LINK45">State IDs List</A> <BR>
 <A NAME="LINK1"></A> <BR>
<BR><HR WIDTH=90%><BR><FONT COLOR=#FF0000><CENTER><H2>Introduction</H2></CENTER></FONT>With animation command you can create new interactive actions for Lara.<BR>
Any object, like an animating, could have new functions if you create an animation to interact with it.<BR>
<BR>
The issue to perform to reach this targer are:<BR>
<BR>
<UL><LI> Create a new animation with Wad Merger<BR>

<LI> Type an Animation command to set the keystroke to use and the correct position about when activate your custom animation in game.<BR>
<LI> Add further NG AnimCommand in your custom animation to perform some special effects.</UL><BR>
 <A NAME="LINK2"></A> <BR>
<FONT COLOR=#FF0080><H3>Create a new animation with Wad Merger</H3></FONT>This operation could be difficultous, anyway you can find in internet some tutorial to learn how do it.<BR>
Try to visit <A HREF="http://www.trsearch.org/Tutorial.php" TARGET="Tutorials on TR Search website" >Tutorials on TR Search website</A> <BR>
<BR>
In some case you could also use standard animation of tomb4 or other tomb raider adventures and then use it with other targets.<BR>
 <A NAME="LINK3"></A> <BR>
<FONT COLOR=#FF0080><H3>Type an Animation script command</H3></FONT>In this document it will be described how verify the correct position and conditions to start your animation, while for general informations about Animation command you can read the html version of built-in help file you find also in NG_Center program: <A HREF="sub_anim1.htm" TARGET="Syntax of Animation script command" >Syntax of Animation script command</A> <BR>
 <A NAME="LINK4"></A> <BR>
<FONT COLOR=#FF0080><H3>Add a NG AnimCommands to your custom animation</H3></FONT>The NG AnimCommand are exported triggers in the form of SetPosition anim command.<BR>
You can export flipeffects and actions as NG AnimCommands, simply opening the Trigger Type window and clicking on [Export AnimCommand].<BR>
You'll be prompted to type the number of frame about when perform this animcommand and then 
you'll receive a text like this:<BR>
<BR>
***********************************************************<BR>
Add a SetPosition anim command with following values:<BR>
<BR>
Set Position [-24556] [136] [5635]<BR>
<BR>
Infos about exported trigger<BR>
-------------------------------------------------------------------------------<BR>
Exporting: TRIGGER(5635:0) for FLIPEFFECT(136)<BR>
<#> : Lara. (Physics) Vertical. Attract Lara <&>up/down with (E)speed<BR>
<&> : Down (Always, jumping/falling phase)<BR>
(E) : Speed=   22<BR>
<BR>
AnimCommand: Frame=20  <BR>
-------------------------------------------------------------------------------<BR>
************************************************************<BR>
<BR>
Some infos are only for reference, the important data is this:<BR>
<BR>
Set Position [-24556] [136] [5635]<BR>
<BR>
Now in wad merger, open animation editor with Lara selected, and choose your custom animation.<BR>
Now click on little icon with little digits: "01010".<BR>
In new window select in combo box the type  "Set Position".<BR>
Type in three white frames at right the three numbers you received from NGLE, in our example the numbers are: [-24556] [136] [5635]<BR>
and click on [Add] button.<BR>
<BR>
Now save the wad: (File->Save wad)<BR>
<BR>
Remark: a good trick to expand in future our animcommand in easy way, is to export as AnimCommand the flipeffect to perform a triggergroup typed in script.dat:<BR>
<BR>
Exporting: TRIGGER(515:0) for FLIPEFFECT(118)<BR>
<#> : TriggerGroup. Perform <&>TriggerGroup from script.dat in (E)way<BR>
<&> : TriggerGroup=    3<BR>
(E) :  Continue performing (it will be always performed until you stop it)<BR>
<BR>
In above example the animcommand will perform the TriggerGroup=3 ...<BR>
<BR>
In this way, we could add many triggers and conditions in our TriggerGroup in future with no need to modify furtherly the wad file or the tr4 file.<BR>
More, this way is, in some circustance, the only way to create effects really very complex.<BR>
 <A NAME="LINK5"></A> <BR>
<BR><HR WIDTH=90%><BR><FONT COLOR=#FF0000><CENTER><H2>The TestPosition command</H2></CENTER></FONT>From version 1.1.9.8 there is the new TestPosition command.<BR>
<BR>
Syntax: TestPosition= <A HREF="#LINK6">IdTestPosition</A> , <A HREF="#LINK7">Flags (TPOS_...)</A>  , <A HREF="#LINK8">Slot Moveable</A>  , <A HREF="#LINK9">XDistanceMin, XDistanceMax</A> , <A HREF="#LINK10">YDistanceMin,  YDistanceMax</A> ,  <A HREF="#LINK11">ZDistanceMin, ZDistanceMax</A> ,  <A HREF="#LINK12">HOrientDiffMin, HOrientDiffMax</A>  ,  <A HREF="#LINK13">VOrientDiffMin, VOrientDiffMax</A> , <A HREF="#LINK14">ROrientDiffMin, ROrientDiffMax</A> <BR>
<BR>
Scope: To use in [Level] section<BR>
<BR>
With TestPosition you can set all data necessary to verify if lara has a correct position with respect to other item (all moveables with the given Slot)<BR>
Then you'll have to type the IdTestPosition also in DistanceForEnv field of Animation= or MultEnvConditon= script commands to transform it in an effective condition (ENV_ITEM_TEST_POSITION).<BR>
<BR>
Descriptions of TestPosition fields:<BR>
 <A NAME="LINK6"></A> <BR>
<FONT COLOR=#FF0080><H3>IdTestPosition field</H3></FONT>In this field you type a Identificative number to call this TestPosition command from other commands like Animation= or MultEnvConditions= (typing this id in DistanceForEnv field)<BR>
<BR>
If you type many TestPosition commands in same [Level] section, each of them should have a different (progressive) Id number.<BR>
 <A NAME="LINK7"></A> <BR>
<FONT COLOR=#FF0080><H3>Flags (TPOS_...) field</H3></FONT>You can type one or more TPOS_ constant values in this field to set some special features.<BR>
If you don't wish use any TPOS_ flag type IGNORE in this field.<BR>
<BR>
See descriptions of TPOS_ values in Reference panel of NG_Center in MNEMONIC CONSTANTS list.<BR>
 <A NAME="LINK8"></A> <BR>
<FONT COLOR=#FF0080><H3>Slot Moveable field</H3></FONT>In this field you type the slot (the number or the name) of items you mean check.<BR>
<BR>
 <A NAME="LINK9"></A> <BR>
<FONT COLOR=#FF0080><H3>XDistanceMin and XDistanceMax fields</H3></FONT>In these two field you have to type the min and max valid distance from X origin of lara and X origin of item to test.<BR>
To understand what is the X axis watch this image:<BR>
<BR>
 <IMG SRC="ExTestPosition_Axis.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
In light blue color you see the X axis and its orientation.<BR>
The effective difference you compare with these two field is given by X_Lara_origin - X_Item_Origin.<BR>
For this reason, normally, the range you type are always a negative value for XDistanceMin and a positive value for XDistanceMax<BR>
<BR>
For exaple if you choose:<BR>
XDistanceMin = -256<BR>
XDistanceMax = +256<BR>
<BR>
this means you accept a tollerance of one click (a sector is 1024 units, so a click is 256 units) of difference between lara and item on X axis.<BR>
Other example, if you set 0 for min and max X distance this means you require that lara is nose vs nose with other item (for example a ninja) and neither a pixel of difference should exist.<BR>
Anyway, choosing  0 and 0 should be very stupid, of course, because you'll have always need of some tollerance.<BR>
Last example for X difference range:<BR>
If the item to test is a coffe cup, and the cup in game give a difference on X axis of +100 , this means that the cup should be about close on left hand of lara. While if the difference was -100 the cup should be near to right hand of Lara.<BR>
<BR>
When you compute the valid range for X axis (or others) you should keep in mind the concept of "Relative axis" (see next paragraph) used in TestPosition comparation.<BR>
 <A NAME="LINK15"></A> <BR>
<FONT COLOR=#FF0080><H3>Relative Axis</H3></FONT>A complication, to understand the comparations of testpostion, is that the axis are relative to current orientation of lara, while usually, in 3d world we think to have fixed x,y,z coordinates.<BR>
When you compute the difference for x relative axis for example the engine fixes the origin of 3d world to origin of lara, and it will (ideally) rotate the 3d world to have facing of lara (where she is looking) in same direction of wished axis<BR>
<BR>
The image of axis explain this situation<BR>
<BR>
 <IMG SRC="@ExTestPosition_Axis.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
For above reason, if you set as Z difference (Z axis, see the ExTestPosition_Axis.jpg picture) as 256 units and the condition is true, this means that, in front of lara, the other item will be to 1 click of distance in front, indifferently if in 3d world lara is at the left or the right (watching the game screen) of other item, because the position will be changed before performing the comparation to have lara at 0,0,0 and looking in exact axis direction, i.e. whre lara is looing it will become the new Z axis direction.
The speech is complicated but using the examples of AnimationTestPosition.zip file you can understand it, and you'll discover that it works very fine.<BR>
Note: this method has been created by Eidos programmers and not by me. I'm using the specific procedure used by default tomb to test the position of items with them lara should interact.<BR>
 <A NAME="LINK10"></A> <BR>
<FONT COLOR=#FF0080><H3>YDistanceMin and YDistanceMax fields</H3></FONT>This couple of values set the range for distance on Y axis.<BR>
See the image "ExTestPosition_Axis.jpg", the y axis has white color.<BR>
<BR>
Many description I given to explain the X difference range are good also for Y range, anyway in this case there is further complication because while the X and Z origin of lara is always the same, at half of her body, the Y origin of lara changes in according with current animation.<BR>
I suggest to use the diagnostic to understand what is the Y origin of lara in animation from what you mean start to launch your custom animation.<BR>
Pratically you should type in [Options] section of script.txt the command:<BR>
<BR>
Diagnostic= ENABLED<BR>
<BR>
So in game you'll see many value about lara.<BR>
Look the "Cy=..." value.<BR>
To understand better what it means, you should build a sample project where the floor is to 0 clicks, then you should extrude some sector to have 4 clicks of height, and also some hole in the floor of 4 clicks.<BR>
The targert of these test will be to see what is the Cy of lara when she is on floor. The cy should be "0" if also the floor of room is 0 click.<BR>
When lara move up a sector hight 4 click the Cy should be Cy = -1024 because upward the y axis in negative.<BR>
Differently, if lara go down in the hole deep 4 click the Cy should become +1024 because there are 4 clicks of difference than flat floor.<BR>
These experiment are enough stupid because we already know the results, anyway I made this example to explain how discover the reference of Y origin of lara for all animations.<BR>
For example if lara hangs to edge of elevated 4 click block, we have another animation (that of hanging) and we could discover that in this animation the Y origin is no more to lara's feet but now is where lara has her knees(!)<BR>
Creating a sample project (always with floor to 0 clicks) and creating also a pool room (a room with water), we could discover other Y origins for particular standard animations for example when lara is floating on water surface the Y origin of lara is the same of Y coordinate of water surface. Also while lara is floating up and down for the waves the Cy value reamins the same. So in this case the Y origin is about on the neck of lara.<BR>
<BR>
So, when you create your TestPosition command you should verify as first thing what is the point of lara where there is the Y origin in animation from what you mean launch your custom animation, and build your Y range on this reference.<BR>
<BR>
Now we could perform some examples using stand-up position of lara, when the Y origin is on her feet.<BR>
<BR>
If the item is a little ball, and it is in front of lara, when the ball will be heigh like the head of lara, the difference will (about) + 600 while if the difference is negative, for example - 1024 this means the ball is an hole below lara than one sector.<BR>
<BR>
Differently than example for X Range, when we set a range for Y distance, it's not sure we'll use same value with - and + signs, bacause when the Y pivot (origin of lara on Y axis) is in her feet, we could require different abs values for min and max.<BR>
<BR>
For example, if we want that above little ball (big like head of lara and with its Y origin in the center of sphere) was (about) in front of lara's head, we should set as Y ranges somewhat like:<BR>

YDistanceMin = 550<BR>
YDistanceMax = 650<BR>
<BR>
As you see, there is no negative value in above values.<BR>
This happen because lara is height about 3 clicks, so 256*3 = 768 units (exactly 800 units).<BR>
We wish that the ball was in front of head of lara, so the ball cann't be lower than neck of lara, and the neck is about to 512 units from feet (y origin) for this reason we set as min Y distance 550, because if it was less of 550 it means the ball is very close on feet of lara. <BR>
By other hand, we neither wish to have the ball so much over the head of lara, and since the top of lara's head is 768 the max distance should less than 768 (we used 650)<BR>
<BR>
Remember that we work on relative axis (see above paragrah) so it's no important if Y origin of lara or item are positive or negative, the difference will work always in correct way.<BR>
When the Y difference (in example of the ball) is 0 this means the ball is in front of feet of lara, and hence in wrong position.<BR>
 <A NAME="LINK16"></A> <BR>
<FONT COLOR=#FF0080><H3>Size of Lara</H3></FONT>To understand better the size and mesh position of Lara in stand up position see this image:<BR>
<BR>
 <IMG SRC="ExTestPosition_LaraMesh.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
In spite of some distortion <BR>
for perspective view, we could suppose following sizes for lara:<BR>
<BR>
Height in stand-up position (picture A or C) = 800<BR>
<BR>
Width stand-up, from hand to hand  (picture A) = 320<BR>
<BR>
Depth of lara by profile (picture C) = 130<BR>
<BR>
Height in all fours position (picture D) = 320<BR>
<BR>
Height in climb position (picture B) = 600<BR>
<BR>
 <A NAME="LINK11"></A> <BR>
<FONT COLOR=#FF0080><H3>ZDistanceMin and ZDistanceMax fields</H3></FONT>With these two fields you set the distance range on Z axis.<BR>
The z axis is always the direction where lara is looking.<BR>
When the Z difference (Lara.Z - Item.Z) is negative this means that item is in front of lara, while if difference is positive lara has passed over the item and now it is at her back.<BR>
 <A NAME="LINK12"></A> <BR>
<FONT COLOR=#FF0080><H3>HOrientDiffMin and HOrientDiffMax fields</H3></FONT>These two fields set the acceptable range for the relation (difference) between horizontal orientation (facing) of Lara and Item.<BR>
The horizontal orientation is given by Lara.HorizonalOrient - Item.HorizontalOrient.<BR>
To understand what I mean for "Horizontal" facing you could look this picture:<BR>
<BR>
 <IMG SRC="ExTestPosition_H_Orienting.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
The default H facing of items (lara or others) is 0 and this is the position you see in NGLE when you have just placed an item in the level map.<BR>
To understand how the difference between H orientation changes you should see the project in AnimationTestPosition.zip file.<BR>
<BR>
If you set correct distance ranges (see previous fields) but you wrong the horizontal orientation difference you can get to have lara close on item (correctly) but the item is not showing the correct side to lara.<BR>
For example if you create an object like a cabinet, and you wish create an animation where lara forces the lock to open it, it's necessary that, not only lara is close on cabinet object, but also that lara has in front of her the lock, because if lara has in front the back of cabinet or some side, the distance could be correct but the animation should have no sense.<BR>
<BR>
You should as first step find the ideal difference between H orientation and then create a range where there is at least a little tollerance.<BR>
For example with the cabinet the diffrence could be $8000 (
32768) (face to face) and the range should have a Min a few less for example $7f00  while the max bigger than same tollerance ( +/- $100 ) i.e. $8100.<BR>
 <A NAME="LINK13"></A> <BR>
<FONT COLOR=#FF0080><H3>VOrientDiffMin and VOrientDiffMax fields</H3></FONT>These two values set the range for difference of Vertical orientation.<BR>
See this image:<BR>
<BR>
 <IMG SRC="ExTestPosition_vOrienting.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
This range is not very important because 99 times on 100 both items (lara and other item) will have VOrientation = 0<BR>
<BR>
You could set a range as  Min= -
200 and Max = +200<BR>
The very seldom case where lara has a different VOrient is the run with rash, when she swimm underwater or she is diving.<BR>
Anyway you can use the sample project in AnimationTestPosition.zip file to verify this situation.<BR>
 <A NAME="LINK14"></A> <BR>
<FONT COLOR=#FF0080><H3>ROrientDiffMin and ROrientDiffMax fields</H3></FONT>These two fields set the valid range for difference of Rotating Orientation between Lara and item.<BR>
Pheraps "Rotating" is not the correct term to describe this kind of facing anyway you can see how it works watching this image:<BR>
<BR>
  <IMG SRC="ExTestPosition_RotOrient.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
It's very seldom the value changes, it should be always 0, so also the difference between lara and item should be zero.<BR>
Anyway, this value changes a bit when lara is running with rush and she is turning at left or right.<BR>
You can type as range -200  +200 but probably you can also type 0 and 0 in most situations.<BR>
 <A NAME="LINK17"></A> <BR>
<BR><HR WIDTH=90%><BR><FONT COLOR=#FF0000><CENTER><H2>The project Test Lara Position</H2></CENTER></FONT>In zip file "AnimationTestPosition.zip" you find all source files to create a little project.<BR>
This project has the target to explain how set the correct ENV_ conditions and TestPosition commands to verify when lara is in wished position to start our custom animation.<BR>
 <A NAME="LINK19"></A> <BR>
Before beginning with specific samples I have some suggestions.<BR>
<BR>
<FONT COLOR=#FF0080><H3>Suggestions</H3></FONT><UL><LI>When you want create an animation to interact with some item (moveables) it's better to use the new ENV_ITEM_TEST_POSITION condition linked with a TestPosition command, because the old env condition to detect the position of items don't allow to work on range of values but only to set a fixed distance with poor results.<BR>
I let in NG_Center the old ENV_ITEM_EXTRA_ ... conditions only for backward compatibility but it's better don't use ever them.<BR>
<BR>
<LI> To discover the values to type in TestPosition command you should enable the full diagnostic with following commands in [Options] section:<BR>
<BR>
Diagnostic=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENABLED<BR>
LogItem=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FLI_SHOW_DIFFERENCES,  IndexItemToLog<BR>
<BR>
The Diagnostic enable the showing of infos about lara on the screen, while the new command LogItem permits to have same information also for another item. You have to type the index of this item in LogItem (IndexItemToLog)<BR>
The flag FLI_SHOW_DIFFERENCES is very useful for our job, because it shows the ideal data to use in TestPosition command.<BR>
<BR>
<LI> When you want create an animation to interact with a moveable, you should place this item in the level and type its index in LogItem command.<BR>
Then, in game, you should try to reach the position where lara should be to start correctly your custom animation.<BR>
Watching the Difference value on screen you'll get the ideal values to set in TestPosition, adding a couple of - / + values (the tollerance) to each of them, to create the tollerance range for each value.<BR>
Well, in this operation it's necessary remember to place this item to get that, in wished position of lara, the item had original facing and lara was at left  (in ngle view) of item, i.e. the DifZ should be negative or 0.<BR>
An exception is when you want place lara on a side of item, in this case the ZDif could be also  positive, just item had the original facing.<BR>
There is this complication because the engine would like alwasys the disposition  Lara.z &lt;  Item.z and  Item.HOrient = 0<BR>
<BR>
If you require absolutely to have lara.z coordinate &gt; Item.z you can read the difference value on screen inverting the sign.<BR>
For example if you read  ZDif = +400  you should use as ideal position  ZDif =  -400. In this case, if XDif is different than 0, you should invert also it: if XDif was -150 you should consider as ideal position XDif = +150. <BR>
Rremark: This speech doesn’t regard the YDif value, because it’s always the value you read on screen.<BR>
<BR>
This expedient is necessaery only to detect the correct values to type in testPosition command, but when you created your TestPosition command,  your TestPosition command will be able to handle correctly that item with any rotation you wish use in final level.<BR>
<BR>
<LI> Once you create your Animation and TestPosition command, it's advisable to test them in game with Animation command working in diagnostic mode.<BR>
To do work in diagnostic mode an Animation command just you set as AnimIndex to perform (the first field of Animation command) a negative number.<BR>
In this way no animation will be performed, of course, and you'll be able to verify if conditions and position you set in script.txt work fine.<BR>
When the animation should be performed you see ont the screen a text like "Anim-1=YES" where that "-1" is the negative number you typed as AnimIndex.<BR>
The reason to use this method, instead perfroming immediatly the real custom animation, is to verify in fast mode if animation could be performed in correct position and ONLY in correct position.<BR>
If you use real animation you should everytime wait the end of custom animation and then to move back lara to previous position, while in diagnostic mode you can move lara around the critical zone to detect in precise way its zone.<BR>
If in this check you find some bad distance, just you change the values in TestPosition command, build the script and then retry newly.<BR>
</UL><BR>
 <A NAME="LINK18"></A> <BR>
<FONT COLOR=#FF0080><H3>Sample A - In front of right rear wheel of Jeep</H3></FONT>In this sample we'll try to set an animation command where is required that lara was on all fours, in front of right rear wheel of Jeep (animating6)<BR>
Pratically our ideal position is this:<BR>
<BR>
 <IMG SRC="ExTestPos_SampleA.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
The reason could be to do a custom animation where lara changes a wheel. :-)<BR>
The first step is to discover the values to type in TestPosition command.<BR>
This command accept a list of ranges for each axis and orientation (facing) type.<BR>
The values are always differences between Lara and item on what she should interact.<BR>
When we enable the diagnostic (see above <A HREF="#LINK19">Suggestions</A> ) we could see the difference values on screen, in right bottom corner.<BR>
 <A NAME="LINK22"></A> <BR>
<FONT COLOR=#FF0080><H3>Compute from ideal position to TestPosition values</H3></FONT><IMG SRC="ExTestPos_SampleA1.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
The values begin with "Dif:"<BR>
<BR>
In this case our ideal values for distances on axis are: DifX = 605  DifY = 0  DifZ=-579<BR>
<BR>
We can use these value to build the x, y and z ranges in this way:<BR>
<BR>
XDistanceMin =  605-300<BR>
XDistanceMax = 605+300<BR>
<BR>
YDistanceMin = 0-128<BR>
YDistanceMax= 0+128<BR>
<BR>
ZDistanceMin= -579-200<BR>
ZDistanceMax= -579+200<BR>
<BR>
I added to each ideal value a tollerance value to build a range, since, requiring to have lara exactly in ideal position, it’s not possible because the player will be never able to reach in perfect way that position.<BR>
I used “300” as X tollerance, “128” as Y tollerance, and “200” as Z tollerance.<BR>
If you set value bigger, lara will result in correct position also when she is a bit far to ideal position, while if you type a littler tollerance, lara will have to go very close on ideal position.<BR>
<BR>
Now we have to do same compute for difference of orientations (facing).<BR>
On screen we read:<BR>
<BR>
XOrientDif=-16249 ($C087)<BR>
VOrientDif= 0 ($0000)<BR>
ROrientDif= 0 ($0000)<BR>
<BR>
There is a reason to show the orientation number also in hexadecimal format (number with “$” sign in front): the facing we wish will be almost always one of these: $0000 (East in NGLE),  $4000 (South),  $8000  (West) or $C000 (North)<BR>
Hence, we should around the value we read because it’s a bit wrong. In this case the correct value will be $C000 because it’s the most near to value on screen ($C087).<BR>
So we’ll use $C000 as ideal value for  HOrientDifMin / HOrientDifMax range.<BR>
Since $c000 in decimal is -16384, the value for H Orient range should be:<BR>
<BR>
HOrientDifMin = -16384-$0800<BR>
HOrientDifMax = -16384+$0800<BR>
<BR>
In this case I used as H Orient tollerance the value $0800.<BR>
It’s more easy understand the tollerance for orientation using the hexadecimal values ($) since the  degrees are $4000 = 90 degrees, $2000 = 45 degrees,  $1000 = 22.5 degrees, $0800 = 11.25 degrees, ect.<BR>
I used a tollerance + or - of 11 degrees, but pheraps it  was better to use the standard value used in tomb4: $1000 as H Orientation Tollerance.<BR>
<BR>
About the VOrient and ROrient in this case are not meaningfull, so just type a range where the ideal value is 0.<BR>
<BR>
Summarizing all above computes our TestPosition command will be:<BR>
<BR>
TestPosition=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1, IGNORE, ANIMATING6, 605-300, 605+300, 0-128, 0+128, -579-200, -579+200,  -16384-$0800, -16384+$0800, -1000,1000,-1000,1000<BR>
<BR>
While the animation command could be:<BR>
<BR>
Animation=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-1, IGNORE,IGNORE, IGNORE, ENV_ITEM_TEST_POSITION, 1,IGNORE, STATE_ON_ALL_FOURS_BACK, &gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE_ON_ALL_FOURS_FORWARD, STATE_ON_ALL_FOURS_STANDING, STATE_ON_ALL_FOURS_TURN_LEFT, &gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE_ON_ALL_FOURS_TURN_RIGHT<BR>
<BR>
In this command you can notice:<BR>
the first “-1” value, to do work in diagnostic mode the command. <BR>
When the animation should be performed you see on screen “Anim-1=YES”<BR>
<BR>
The “ENV_ITEM_TEST_POSITION” condition to use the TestPosition with Id = “1”<BR>
<BR>
Building the script and  checking in game, you can verify when the animation should be performed.<BR>
Try to change the tollerance to verify how change the esite.<BR>
<BR>
Remark: in this sample I’ve not typed any keyboard command to enable our custom animation. This happens only because we are working in diagnostic mode, but when you use really a custom animation will be necessary choose some keyboard command to start the animation.<BR>
For example if we want to use the Jump command to perform the change of wheel when lara is in correct position the animation command should be:<BR>
<BR>
Animation=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;650, KEY1_JUMP,  IGNORE, IGNORE, ENV_ITEM_TEST_POSITION, 1, IGNORE, STATE_ON_ALL_FOURS_BACK, &gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE_ON_ALL_FOURS_FORWARD, STATE_ON_ALL_FOURS_STANDING, STATE_ON_ALL_FOURS_TURN_LEFT, &gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE_ON_ALL_FOURS_TURN_RIGHT<BR>
<BR>
Supposing that your custom animation was the 650.<BR>
 <A NAME="LINK20"></A> <BR>
<FONT COLOR=#FF0080><H3>Sample B - In front of the back of Jeep</H3></FONT>In this sample we want create an animation when lara is in front of the back of jeep (animating6):<BR>
<BR>
 <IMG SRC="ExTestPos_SampleB.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
The ideal position, looking in diagnostic mode could be:<BR>
<BR>
 <IMG SRC="ExTestPos_SampleB1.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
The ideal position is: <BR>
<BR>
DifX = 0  DifY = 0   DifZ = -981  OrienHDiff = 0<BR>
<BR>
and will be converted in following TestPosition command: <BR>
<BR>
TestPosition=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2, IGNORE, ANIMATING6, 0-400, 0+400, 0-127, 0+127, -981-200, -981+200,  0-$1000, 0+$1000,-1000,1000,-1000,1000<BR>
<BR>
See <A HREF="#LINK22">Compute of ideal position</A>   for details about the compute of conversion between ideal position and final data to type in TestPosition command.<BR>
<BR>
In this B Sample there is a news in animation command :<BR>
<BR>
Animation=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-2,KEY1_ACTION,IGNORE, FAN_ALIGN_TO_ENV_POS, ENV_ITEM_TEST_POSITION, 2, IGNORE, STATE_STOP<BR>
<BR>
Where we used the FAN_ALIGN_TO_ENV_POS flag to enable the self-aligment of lara in ideal position.<BR>
 <A NAME="LINK21"></A> <BR>
<FONT COLOR=#FF0080><H3>Self-Alignment feature</H3></FONT>We already know  the self-aligment feature to have seen it many times in old tomb4. For example when lara goes in front of pushable object, when the player hit the action key, lara will move byself to reach a precise position (ideal position) and only after this adjustment the push/pull animation will be started.<BR>
Now also with our custom animation we can have same feature.<BR>
The advantage of this feature is to reach in same moment two targets:<BR>
<UL><LI> Permit to Lara to have a wide zone to interact with some object (like the pushable), since also when lara is far from ideal position she will be able to interact with pushable object.<BR>
<LI> To have the sureness that the custom animation will be started from a very precise (and always the same) ideal position,  avoiding an incoherent movement between animation and object.</UL><BR>
<BR>
To enable the self-adjustment just to add in FAN_ flags of Animation command the FAN_ALIGN_TO_ENV_POS flag.<BR>
<BR>
This flag works only when you use also a TestPosition to verify the correct position of lara with the ENV_ITEM_TEST_POSITION condition.<BR>
The reason is that, the self-alignment will use own the data in TestPosition to discover the exact target (ideal) position to reach with self-alignment.<BR>
The engine will perform an inverse compute to get, from the ranges in TestPosition, the ideal position to reach.<BR>
The formula used is simple:  (MaxRange + MinRange) / 2<BR>
In this way for each X, Y, Z and H Orient will be found the orientation and position to do reach to lara.<BR>
<BR>
Remarks:<BR>
- When you use self-alignment you should always set some keyboard command for Animation= command, because otherwise lara will move byself in unpredicatble way.<BR>
<BR>
- The self-adjustament should work fine when Lara (at start) is in stand-up position or she is swimming underwater or floating on water, but in many other positions, like hanging position (climb, monkey) or special position like “on all fours” it could fail.<BR>
<BR>
- If in game Lara moves byself endless, this means you mistaked somewhat to compute the ideal position, in fact you set an ideal position where lara is not able to go, probably because the collision box of item stops her. <BR>
In this case you have to modify the ideal value for Z or X in according with what axis is the distance between lara and the item.<BR>
<BR>
 <A NAME="LINK23"></A> <BR>
<FONT COLOR=#FF0080><H3>Sample C - In front of King Throne</H3></FONT>In this sample we want reach this position:<BR>
<BR>
 <IMG SRC="ExTestPos_SampleC.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
As you can see in this sample we requires also another conditon: lara has to hold a flare in the hand.<BR>
About the ideal position it could be this:<BR>
<BR>
 <IMG SRC="ExTestPos_SampleC1.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
Using the ideal position you see in above image we can build the TestPosition as showed in <A HREF="#LINK22">Compute of ideal position</A>  in above paragraph.<BR>
<BR>
The interesting thing in this sample is we wish verify also antoher ENV condition (other the usual ENV_ITEM_TEST_POSITION condition).<BR>
We want that lara hold also a flare to start our custom animation.<BR>
 <A NAME="LINK24"></A> <BR>
<FONT COLOR=#FF0080><H3>To use multiple ENV conditions</H3></FONT>Since we can directly set only one ENV_ condition in Animation= command, to pass over this limit we have to use a MultEnvCondition command where store our two conditions (but it could be also a big number of conditions), while in Animation command we’ll use the ENV_MULT_CONDITION conditon and in DistanceForEnv field, we’ll type the ID of MultEnvCondition with our conditions to test.<BR>
Using this method we can perform a lot of ENV condition for each Animation command.<BR>
<BR>
The MultEnvCommand has the first field for its ID, and following fields are triple values serie. Each triple group has following fields:  <BR>
<BR>
EnvCondition<BR>
DistanceForEnv<BR>
Extra field<BR>
<BR>
The names of above field are the same of Animation command, and we can use them in same way.<BR>
<BR>
So, to have a Multiple condition where we want check for conditon “lara holds flare” and “Lara is in TestPosition” we’ll type following commands:<BR>
<BR>
;The test position:<BR>
TestPosition=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3, IGNORE, ANIMATING7, 0-512, 0+512, 0-127, 0+127, -860-300, -860+300,  0-$1000, 0+$1000, 0,0,0,0<BR>
;The multenv condition<BR>
<BR>
MultEnvCondition= 1, ENV_HOLD_EXTRA_ITEM_IN_HANDS, IGNORE, HOLD_FLARE, &gt;  ;First condition: lara holds the flare<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     ENV_ITEM_TEST_POSITION, 3, IGNORE  ;Second condition: the testposition 3<BR>
<BR>
;and finally the Animation command (in diagnostic mode)<BR>
<BR>
Animation=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-3, KEY1_ACTION, IGNORE, FAN_ALIGN_TO_ENV_POS, ENV_MULT_CONDITION, 1 , IGNORE , STATE_STOP<BR>
<BR>
 <A NAME="LINK25"></A> <BR>
<FONT COLOR=#FF0080><H3>Sample D - In front of Metal Gate</H3></FONT>In this case we want lara in front of metal gate:<BR>
<BR>
 <IMG SRC="ExTestPos_SampleD.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
The data with ideal position is:<BR>
<BR>
 <IMG SRC="ExTestPos_SampleD1.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
Animation=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-4, KEY1_ACTION, IGNORE, FAN_ALIGN_TO_ENV_POS, ENV_ITEM_TEST_POSITION, 4, IGNORE, STATE_STOP<BR>
<BR>
<BR>
Using the ideal position you see in above image we can build the TestPosition as showed in <A HREF="#LINK22">Compute of ideal position</A>  in above paragraph.<BR>
 <A NAME="LINK26"></A> <BR>
<FONT COLOR=#FF0080><H3>Double facing with TestPosition</H3></FONT>In this D sample we used the flag TPOS_DOUBLE_HORIENT in TestPosition command.<BR>
This flag permits to do work the correct position also in opposite side of the object.<BR>
If you try in game you see that it’s possible start animation from both sides of the gate.<BR>
<BR>
This flag works fine only when the pivot (origin x,y,z) of object is really at center of the visible meshes. Unfortunately in some circustances the pivot is in a corner of sector where the item will be placed, and in this case the double horient will get poor results.<BR>
 <A NAME="LINK27"></A> <BR>
<FONT COLOR=#FF0080><H3>Move the origin of Objects using MetaSequoia</H3></FONT>If you need to move the pivot of some object you should to use MetaSequoia program and StrPix program.<BR>
<BR>
With StrPix program you find the mesh of your object and then export in DXF format this mesh.<BR>
Then import the .dxf file in MetaSequoia importing the object with these settings:<BR>
<BR>
 <IMG SRC="Import_meta.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
Now in metasquoia each sector is 1/4 of tomb4 sector.<BR>
The gate I used has been moved to have its origin in center of tomb4 sector.<BR>
You can see how it appears in metasequoia:<BR>
<BR>
 <IMG SRC="ExMeta1.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
The red point is where is in tomb4 the center of sector. Try to use the colored line of three axis as reference.<BR>
The tomb4 sector in above picture has been highlighted with white color.<BR>
<BR>
One time you moved your object in center of tomb4 sector, you export it in dxf formato using following parameters:<BR>
<BR>
 <IMG SRC="Export_meta.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
Then you’ll import in StrPix the modified .dxf file in same mesh of object.<BR>
<BR>
After this operation you should also to use the program FexAnim to fix the collision and visibility box of your object, because moving the mesh with metasequoia we have let the collision box in previous position and in game this should be a problem.<BR>
<BR>
With FexAnim you can work only on tr4 file, so you should:<BR>
<OL><LI> Build the level to have a tr4 file<BR>
<LI> Load this tr4 file with FexAnim<BR>
<LI> Select in left frame your object<BR>
<LI> Clik on item "Show [x]"<BR>
<LI> Now you should click on [Automatic Bound] button for each animation of your object. You can see in top left corner of FexAnim window the list of animations.<BR>
<LI> When you completed all animations, choose from menu "Save as ..." and choose newly the same .tr4 file<BR>
<LI> Now, to have your correct object in wad file, you should use wad merger to move the object from .tr4 file to .wad file<BR>
</OL><BR>
 <A NAME="LINK28"></A> <BR>
<FONT COLOR=#FF0080><H3>Sample E - Lara in front to the cube</H3></FONT>We want get lara in front of cube for each side:<BR>
<BR>
 <IMG SRC="ExTestPos_SampleE.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
 <A NAME="LINK31"></A> <BR>
<FONT COLOR=#FF0080><H3>Facing for all sides</H3></FONT>In this sample we had used the flag TPOS_FOUR_HORIENT in TestPosition to do work our TestPosition for each side of cube.<BR>
<BR>
This flag works fine only when the origin of object is exactly at center of sector and also when the object has a regular shape for each side.<BR>
<BR>
TestPosition=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5, TPOS_FOUR_HORIENT, ANIMATING3, 0-512, 0+512, 0-127, 0+127, -680-200, -680+200,  0-$1000, 0+$1000,0,0,0,0<BR>
<BR>
Animation=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-5, KEY1_ACTION, IGNORE, FAN_ALIGN_TO_ENV_POS, ENV_ITEM_TEST_POSITION, 5, IGNORE, STATE_STOP<BR>
 <A NAME="LINK29"></A> <BR>
<FONT COLOR=#FF0080><H3>Sample F - Lara punchs a Baddy (Full working example)</H3></FONT>In all previous examples we have set only testposition to verify the position but  the custom animation to do work those examples was always missing.<BR>
The reason is simple: I'm not able to create custom animation with Animation editor so I can only to do script commands to verify position for further custom animations.<BR>
However in this Sample F I create a full working example using an animation I found in tomb5 chronicles.<BR>
The animation should be with Lara punchs but in the reality is not own so good that animation for our target.<BR>
If you are able to build new animations you could enhance this example using a real fighting animations set,  while in this example I'll exaplain how create the script commands to handle it.<BR>
 <A NAME="LINK30"></A> <BR>
<FONT COLOR=#FF0080><H3>Compute Ideal Position for Item in motion</H3></FONT>The method to compute the ideal position for Lara with some item in motion is theorically the same we saw in this tutorial, but in this case there is the complication about the continue going of moveable.<BR>
To solve this problem we can perform a simple trick: the position of moveable is present in diagnosic also when the moveable has not yet been triggered in game, so we can try to read the ideal position on screen working on the point where the moveable should be, hence he is not yet visibile.<BR>
<BR>
 <IMG SRC="ExTestPos_SampleF1.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
We can help us, placing a special texture where is the moveable, like in above picture.<BR>
The white circle on red texture, show the x,z position where we placed the baddy, and the little black arrow shows where he is looking, i.e. his facing.<BR>
Now, we can detect the ideal position working on that texture, both on moving baddy.<BR>
We type its index in LogItem command:<BR>
<BR>
LogItem=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FLI_SHOW_DIFFERENCES, 14<BR>
<BR>
We play the game, and we move lara in correct position:<BR>
<BR>
 <IMG SRC="ExTestPos_SampleF2.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
So, reading and rounding the data on screen: <BR>
<BR>
DifX = -25  Y=0  Z=-469 HOrientDif = 757 ($02f5)<BR>
<BR>
We can get these ideal position:<BR>
<BR>
DifX = 0  Y=0  Z= -400  HOrientDif = 0 ($0000)<BR>
<BR>
About the HOrientDif, we give a big tollerance for rotation in west direction  both to east direction and this to compensate the fact that lara punchs using the right arm. <BR>
<BR>
So the testposition command could be:<BR>
<BR>
TestPosition=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6, TPOS_FOUR_HORIENT, BADDY_1, 0-200,0+200, 0-127, 0+127, -400-256, -400+256, 0-$1000 ,0+$1800 ,0,0,0,0<BR>
<BR>
We used the TPOS_FOUR_HORIENT flag to do work above position on all four sides, but this is only a choice, we could also set to work only on single orientation and pherap it was more realistic.<BR>
 <A NAME="LINK32"></A> <BR>
<FONT COLOR=#FF0080><H3>The necessary to add new skills to Lara</H3></FONT>To add some new skills to Lara it's necessary to have:<BR>
<UL><LI> A custom animation to show the new moves for Lara.<BR>
<BR>
<LI> Type an Animation script command, with further TestPosition command, to detetect when there are all conditions to perform our custom animation<BR>
<BR>
<LI> Create some NG AnimCommand to insert in our custom animation to perform some change in game: the actions performed by this NG AnimCommand will be the new skill for Lara<BR>
</UL><BR>
 <A NAME="LINK33"></A> <BR>
<FONT COLOR=#FF0080><H3>The Custom Animation</H3></FONT>We'll use this animation, it's not perfect (only the good girls fight in this way) but it's the best I found. <BR>
 <IMG SRC="ExTestPos_SampleF3.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
To avoid that lara try to punch when she hold crossbow, pistols or other, we have to add also the ENV_FREE_HANDS condition to verify if she has free hands.<BR>
<BR>
MultEnvCondition=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2, ENV_FREE_HANDS, IGNORE, IGNORE,  &gt; ;lara has free hands<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENV_ITEM_TEST_POSITION, 6, IGNORE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;test position for lara close on baddy<BR>
<BR>
Animation=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;445, KEY1_ACTION, IGNORE, FAN_KEEP_NEXT_STATEID, ENV_MULT_CONDITION, 2, IGNORE, STATE_STOP<BR>
<BR>
 <A NAME="LINK34"></A> <BR>
<FONT COLOR=#FF0080><H3>How set a NG AnimCommand</H3></FONT>A NG AnimCommand is a special anim command that will be performed when our custom aimation will be played.<BR>
We can get the data for NG Anim Command click on [Export AnimCommand] in Set Trigger Type window.<BR>
<BR>
See also <A HREF="#LINK4">Add a NG AnimCommands to your custom animation</A>  <BR>
<BR>
Now we have to decide what skill to give to lara and the how we could transform it in a triggergroup.<BR>
<BR>
The skill is to punch an enemy (a baddy1) and our AnimCommand should remove HP (vitality) to enemy and set some movement for baddy to get visible he has been hit.<BR>
<BR>
Our trigger group contains two triggers:<BR>
<BR>
First exported trigger reduces the vitality for enemy:<BR>
<BR>
; Exporting: TRIGGER(2086:0) for ACTION(14)<BR>
; &lt;#&gt; : BADDY_1                    ID:14     in sector:(4,4) of Room4  (This will be replaced by any Baddy found by testposition)<BR>
; &lt;&&gt; : Enemy. Hurth &lt;#&gt;enemy removing (E)Vitality points<BR>
; (E) : Vitality Points=    8<BR>
; Values to add in script command: $5000, 14, $826<BR>
<BR>
While second trigger force a falling down animation for baddy:<BR>
<BR>
; Exporting: TRIGGER(783:0) for ACTION(14)<BR>
; &lt;#&gt; : BADDY_1                    ID:14     in sector:(4,4) of Room4<BR>
; &lt;&&gt; : Force (E) animation (0-31) for &lt;#&gt;object<BR>
; (E) :    3 Animation<BR>
; Values to add in script command: $5000, 14, $30F<BR>
<BR>
The data to type in TriggerGroup command are always the three values for each exported trigger, so our TriggerGroup becomes:<BR>
<BR>
TriggerGroup=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1, $5000+TGROUP_USE_FOUND_ITEM_INDEX, 14, $826, &gt; ; Hurt enemy removing 8 hp<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;               $5000+TGROUP_USE_FOUND_ITEM_INDEX, 14, $30F   ;force anim to thow down the baddy<BR>
<BR>
Remarks:<BR>
We used the TGROUP_USE_FOUND_ITEM_INDEX flag to replace the original item index typed in exported trigger, with (any) item index that TestPosition command will detect in correct position.<BR>
For this reason, hence our trigger in TriggerGroup are refered to a specific moveable with index = 14, our skill will be able to work with all baddy1 in the level.<BR>
In the sample I place another baddy1 with different index, lara is able to trigger him going on heigh floor sector, and you see that our skill works also with this new different baddy1 item.<BR>
<BR>
The animation forced for baddy is a duplicate of another animation, in fact it's always a good rule, don't change any default animation but always duplicate the wished animation in an empty animation slot, and then change it in this new position.<BR>
I used the animation used to kill baddy, but I used it only to do fall him, and then I set as NextAnim (in my duplicated animation) another default animation to do the baddy stands up newly.<BR>
<BR>
Now we can in NGLE export a flipeffect trigger to do perform the TriggerGroup =1:<BR>
<BR>
 <IMG SRC="ExTestPos_SampleF4.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
Clicking on [Export AnimCommand] button, we'll be prompted for frame number when perform this animcommand, I chose the number 12<BR>
<BR>
Remark: when there is a frame rate different than 1 in animation editor, you have to consider the effective frame number that you see in above bar and not that in the bottom of screen with single frames.<BR>
<BR>
We get this text:<BR>
<BR>
--------------------------------------------------------------------------------------------------<BR>
Add a SetPosition anim command with following values:<BR>
<BR>
Set Position [-24564] [118] [1]<BR>
<BR>
Infos about exported trigger<BR>
-------------------------------------------------------------------------------<BR>
Exporting: TRIGGER(1:0) for FLIPEFFECT(118)<BR>
&lt;#&gt; : TriggerGroup. Perform &lt;&&gt;TriggerGroup from script.dat in (E)way<BR>
&lt;&&gt; : TriggerGroup=    1<BR>
(E) :  Mutiple performing (to use when in TriggerGroup there is some condition)<BR>
<BR>
AnimCommand: Frame=12  <BR>
--------------------------------------------------------------------------------------------------<BR>
<BR>
Now we can open wadmerger, select lara and cick on Animation Editor to place above anim command in animation 445.<BR>
The data  to add are:<BR>
<BR>
Set Position [-24564] [118] [1]<BR>
<BR>
See <A HREF="#LINK4">Add a NG AnimCommands to your custom animation</A> <BR>
 <A NAME="LINK35"></A> <BR>
<FONT COLOR=#FF0080><H3>How enhance the fighting sample</H3></FONT>If you try in game our sample you see it works, but not very fine. <BR>
If you have time and the ability to create new animations with animation editor you can give to lara a large set of new fantastic skills.<BR>
<BR>
<FONT COLOR=#FF0080><H3>Different fighting animations</H3></FONT>You could create two or more animations with different fighting mode: punch, kicks ect<BR>
Set for each custom animation a different group of testposition and animation and, furtherly, keyboard command to enable.<BR>
For each different type of animation you should force a different lost of vitality for enemy and a different enemy animation to show his hurting.<BR>
 <A NAME="LINK49"></A> <BR>
<FONT COLOR=#FF0080><H3>Create new non-shooting weapon.</H3></FONT>You could permits to lara to fight using a knife.<BR>
There is some problem to solve because all weapon management is strongly hardcoded.<BR>
I suggest to use this method:<BR>
<UL><LI>Modify the mesh of BURNING_TORCH_ITEM to give the look of knife (or sword)<BR>
<LI>Modify the hand mesh of TORCH_ANIM slot to give same look of above knife<BR>
<LI>Create TestPosition and Animation command like in example of punching the baddy but in MultEnvCondition add also the condition ENV_HOLD_EXTRA_ITEM_IN_HANDS with (in extra field) the value HOLD_ANY_TORCH.<BR>
In this way the animation will be started only if lara holds the torch/knife<BR>
<LI> Create a custom animation where lara hits using the knife<BR>
This animation should be placed in Slot 0 of default Lara and not in slot of TORCH_ANIM because these extra slots are not reachable by custom animation.<BR>
<LI> In the Animation command, that you use to perform this animation, add to FAN flags also the flag FAN_SET_FREE_HANDS_TEMP.<BR>
This flag is necessary to perform custom animations (full working) while lara is holding somewhat in her hands (weapons or torch)<BR>
</UL><BR>
<BR>
Following above suggestions I believe the knife should work fine.<BR>
Theorically you could add other features very comples, like to add some effect to enemy after in its hurting animation. You could realize this target exporting  an action trigger to add blood effect as animcommand and insert it in hurting animation of the enemy.<BR>
<BR>
About the chance to have a common inventory item as knife it's a bit difficultous and now I can only give a general way to follow. <BR>
You should modify an inventory item like a PickupItem to give the look of knife.<BR>
<BR>
In script.txt type a customize command like this:<BR>
<BR>
Customize= CUST_SET_INV_ITEM,  PICKUP_ITEM4<BR>
<BR>
Supposing that our knife was the Pickup4<BR>
Above command it's necessary to preserve always the item in inventory like a weapon (when lara extract the pistols, they remain in inventory)<BR>
<BR>
Then you should create a globaltrigger command with GT_USED_INVENTORY_ITEM and slot of your Pickup4.<BR>
This globaltrigger (when the condition is true)  will perform a triggergroup where you have exported the trigger:<BR>
"Lara. (Mesh) Torch. &lt;&&gt;Give/Remove Torch to/from hand of Lara"  <BR>
<BR>
Setting to "Give" the torch, of course<BR>
<BR>
In this way, we realize first part of our new weapon:<BR>
<BR>
Lara can find and pick up the knife<BR>
It goes in inventory<BR>
Lara is able to use this knife<BR>
And it appears in the hand of lara<BR>
Our custom animation allows to Lara to fight using it and kill the enemies.<BR>
<BR>
There is yet a single problem.<BR>
What happens when lara extract other weapon? Our knife/torch will be thrown out, but this is not the behavior ideal for our skill.<BR>
To solve this problem it's necessary set also another GlobalTrigger command, like this:<BR>
<BR>
GlobalTrigger=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ID GlobalTrigger),  FGT_REMOVE_INPUT,  GT_GAME_KEY1_COMMAND,   KEY1_DRAW_WEAPON,  ... ....<BR>
<BR>
Above global trigger intercepts the game command to extract weapons. <BR>
Adding the FGT_REMOVE_INPUT flag the DrawWeapon command will be removed but only when the condition in IdConditionTriggerGroup is true, otherwise the game command DRAW_WEAPON will be perfomed normally.<BR>
<BR>
For this reason we have to create two triggergroup called by above GlobalTrigger:<BR>
- A TriggerGroup working as Conditional triggergroup, to verify if currently lara hold the torch. <BR>
The trigger to export in this triggergroup will be: "Lara. (Holds) Lara is holding/driving the &lt;#&gt;item"   with item "Holding_Any_Torch" <BR>
Then we'll type the Id of above TriggerGroup in field "IdConditionTriggerGroup" of GlobalTrigger command.<BR>
<BR>
- A TriggerGroup used to solve our problem: what could we do when lara has the torch/knife but the player chose to throw out the knife and to use another weapon? <BR>
An easy but poor solution, is to type in this triggergroup only the flipeffect trigger "Lara. (Mesh) Torch. &lt;&&gt;Give/Remove Torch to/from hand of Lara" setting "Remove"<BR>
In this case it's not necessary to use the FGT_REMOVE_INPUT flag in global trigger.<BR>
When player hit SPACE to laod the guns, the knife will disappear from lara's hand and the command to extract the pistols will work in normal way.<BR>
But this disappearing of knife is a bit weird.<BR>
<BR>
A more difficultous solution but more effective, is to create another custom animation where lara move the her right hand on body bag to take off the knife, and we could place a NG AnimCommand in correct frame of this animation  to remove the mesh of knife.<BR>
The trigger is the same showed above "Lara. (Mesh) Torch. &lt;&&gt;Give/Remove Torch to/from hand of Lara" setting "Remove"<BR>
In this case, in our triggergroup we'll type only the flipeffect trigger to perform our custom animation to take off the knife and the animcommand within it, will do the necessary operation.<BR>
Remark: using this solution it's necessary let in GlobalTrigger the FGT_REMOVE_INPUT flag, because if this flag is missing, our "take-off" animation could be replaced by default animation to throw out the torch/knife, since the game command to draw weapon has been left to pass.<BR>
Differently, with FGT_REMOVE_INPUT flag, the first draw weapon command has been catched and destroyed by our globaltrigger, and used to put off the knife.<BR>
After this operation, player could hit newly the space bar to extract the pistols, and when our custom animation will be completed, the global trigger will be not activared because lara has no more the torch in the hand.<BR>
<BR>
I've not the time to create all this method, anyway I presume it should work.<BR>
 <A NAME="LINK36"></A> <BR>
<BR><HR WIDTH=90%><BR><FONT COLOR=#FF0000><CENTER><H2>Sample G - Conditions to test Room Geometry</H2></CENTER></FONT>In G Sample there are a list of Animation commands in diagnostic mode to detect some shapes  of room geometry respect to Lara.<BR>
Since, many conditions have a clear mean, I'll describe only the most particular environment conditions.<BR>
Remark: many of this samples require to have lara still in stand up position and to hit the ACTION (ctrl) key to perform the conditon.<BR>
<BR>
 <A NAME="LINK37"></A> <BR>
<FONT COLOR=#FF0080><H3>Inner and Outside Corners</H3></FONT>In some condition there is the definition of "inner" corner, reduced with "IN_CORNER" or outside corner , reduced in OUT_CORNER.<BR>
These condition work about the chance for lara to turn a corner, at her left or right in climb mode or hang mode.<BR>
Here there are some image to understand the concept of "inner" or "outside" corners.<BR>
<BR>
 <A NAME="LINK38"></A> <BR>
<FONT COLOR=#FF0080><H3>G1 - Inner Corner</H3></FONT><IMG SRC="ExTestPos_SampleG1.jpg" VSPACE=12 ALIGN="CENTER"><BR>
<BR>
In above picture you can see what I mean for inner (right) corner.<BR>
<BR>
Animation=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-6,  KEY1_ACTION, IGNORE, IGNORE, ENV_CLIMB_RIGHT_IN_CORNER, IGNORE, IGNORE, STATE_CLIMB_DOWN, &gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE_CLIMB_LEFT, STATE_CLIMB_RIGHT, STATE_CLIMB_UP, STATE_CLIMB_START_AND_STANDING<BR>
<BR>
The condition used is ENV_CLIMB_RIGHT_IN_CORNER and it'is true when lara, other to be in climb mode, has an inner climbable wall at right.<BR>
You can see the text "Anim=6=YES" to show the position when the condition is true.<BR>
If you try to move lara at left you'll see the diagnostic change in "Anim-6=no" because lara will be too far from inner right corner.<BR>
Anyway you can also change the DistanceForEnv field to increase the acceptable distance from right wall.<BR>
The default value (used if you type IGNORE in DistanceForEnv) is 140. If you type a bigger value the condition will be true also when Lara is more far from right wall.<BR>
<BR>
 <A NAME="LINK39"></A> <BR>
<FONT COLOR=#FF0080><H3>G2 - Outside Corner</H3></FONT><IMG SRC="ExTestPos_SampleG2.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
In above picture you can see an outside corner.<BR>
<BR>
Animation=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-7, KEY1_ACTION, IGNORE, IGNORE, ENV_CLIMB_LEFT_OUT_CORNER, IGNORE,IGNORE, STATE_CLIMB_DOWN, &gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE_CLIMB_LEFT, STATE_CLIMB_RIGHT, STATE_CLIMB_UP, STATE_CLIMB_START_AND_STANDING<BR>
<BR>
The condition used is ENV_CLIMB_LEFT_OUT_CORNER, set in Animation= -7  script command.<BR>
You can see the diagnostic mexage "Anim-7=YES" because Lara is enough close on left outside corner to turn it.<BR>
 <A NAME="LINK40"></A> <BR>
<FONT COLOR=#FF0080><H3>G3 - Height of Monkey Ceiling</H3></FONT><IMG SRC="ExTestPos_SampleG3.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
The condition ENV_MONKEY_CEILING check for distance of ceiling from lara Y position. <BR>
<BR>
Animation=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-8, KEY1_ACTION, IGNORE, IGNORE, ENV_MONKEY_CEILING, $0705, IGNORE,STATE_STOP<BR>
<BR>
This condition is true only when Lara is on monkey sector and the distance in height from ceiling is in range set in DistanceForEnv.<BR>
Differently by other env condition, the DistanceForEnv requires two values added whereby a simple formula:<BR>
<BR>
MaxClickHeight * 256 + MinClickHeight<BR>
<BR>
For example in our example we checked for an height enclosed in range 5 (minheight)  and 7 (maxheight)<BR>
<BR>
When DistanceForEnv requires a range (like in this case) it's better type the value in hexadecimal format because it's more readable, in fact in hexadecimal the value is  $0705 where you can see the Max ("07") and the Min (05) clicks for height distance.<BR>
While using decimal format the number should be 1797, more difficultous to understand simply reading it.<BR>
<BR>
Remark:<BR>
Please don't confuse you, only in this condition and few other in DistanceForEnv you type a range with clicks values. In the most of ENV conditions the distance will have an absolute value, where one sector = 1024 and a click requires to type 256 in DistanceForEnv.<BR>
<BR>
 <A NAME="LINK41"></A> <BR>
<FONT COLOR=#FF0080><H3>G4 - An HandHold in Front Wall</H3></FONT><IMG SRC="ExTestPos_SampleG4.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
The condition used is ENV_SUPPORT_IN_FRONT_WALL to verify if in the wall in front of lara there is an handhold with correct Y distance and with wished height of space.<BR>
<BR>
Animation=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-9, KEY1_ACTION, IGNORE, IGNORE, ENV_SUPPORT_IN_FRONT_WALL+  &gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENV_POS_STRIP_1+ENV_POS_HORTOGONAL, $0274, IGNORE, STATE_STOP<BR>
<BR>
In this animation command we have used also the ENV_POS_STRIP_1 flag to require that lara was in forwardest side of sector (strip 1) and the <BR>
flag ENV_POS_HORTOGONAL to require lara had correct orientation.<BR>
You can try (hitting CTRL) to verify in game when the condition is "no" if you change orientation or side of sector where lara is.<BR>
<BR>
For this condition the DistanceForEnv field is a bit complex becuase it requires three values: the Min height of handhold (lower side), the max acceptable height for handhold (lower side) but also the height of space over the handhold.<BR>
If we use this condition only to discover where lara is able to hang, the height of space just to be of one click "1", but if we want create an animation to jump in fast way in an hole over the wall, where lara enters in on all fours position, it should be necessary to have at least 2 clicks of height for the space.<BR>
In above Animation command I set:<BR>
<BR>
The minimum Y distance for lower side : 4 clicks<BR>
The maximum Y distance for lower side: 7 clicks<BR>
The minimum height for space over the handhold: 2 clicks<BR>
<BR>
The formula to compact these three values in DistanceForEnv field is:<BR>
<BR>
MinLowerSize + MaxLowerSide * 16 + HeightSpace * 256<BR>
<BR>
Also in this case it's more easy understand this number in hexadecimal formato: it becomes $0274<BR>
<BR>
Remark:<BR>
If you want use this condition to verify when lara has over her an hole in the wall, while she is climbing this wall, the values to type in DistanceForEnv could be different since the Y pivot of lara is different while she is climbing.<BR>
To find the correct values in situation like this, the diagnostic mode is very useful: you type an animation command like above (but you have to change the "2" at end because the climbing state id are differents), and then you move lara up and down to see when the conditon is true (YES). Then you can underatand the better values and change the script command until you find the exact distance values to use.<BR>
 <A NAME="LINK42"></A> <BR>
<FONT COLOR=#FF0080><H3>G5 - Lara monkey has over her a climb wall</H3></FONT><IMG SRC="ExTestPos_SampleG5.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
Above picture show the positive esite for ENV_HOLE_IN_FRONT_CEILING_CLIMB condition<BR>
<BR>
<BR>
Animation=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-10, KEY1_ACTION, IGNORE, IGNORE, ENV_HOLE_IN_FRONT_CEILING_CLIMB + &gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENV_POS_STRIP_1+ENV_POS_HORTOGONAL, IGNORE, IGNORE, &gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE_MONKEY_STILL_OR_HANG_SWING<BR>
<BR>
I used also the ENV_POS_STRIP_1 flag to have lara on border and the ENV_POS_HORTOGONAL flag to have her parallel to border.<BR>
 <A NAME="LINK43"></A> <BR>
<FONT COLOR=#FF0080><H3>G6 - Lara monkey has over and back her a climb wall</H3></FONT><IMG SRC="ExTestPos_SampleG6.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
Above picture show the positive esite for ENV_HOLE_BACK_CEILING_CLIMB condition.<BR>
<BR>
Animation=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-11, KEY1_ACTION, IGNORE, IGNORE, ENV_HOLE_BACK_CEILING_CLIMB + &gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENV_POS_STRIP_3+ENV_POS_HORTOGONAL, IGNORE, IGNORE, &gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE_MONKEY_STILL_OR_HANG_SWING<BR>
<BR>
Please, note that in above Animation command I used the ENV_POS_STRIP_3 instead of ENV_POS_STRIP_1, because lara has to have at her back the climb wall so to have her close on border I had to use ENV_POS_STRIP_3.<BR>
 <A NAME="LINK44"></A> <BR>
<FONT COLOR=#FF0080><H3>G7 - Lara hanged on height wall</H3></FONT><IMG SRC="ExTestPos_SampleG7yes.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
Above picture shows the positive esite for ENV_HANG_WITH_FEET condition.<BR>
<BR>
Animation=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-12, KEY1_ACTION, IGNORE, IGNORE, ENV_HANG_WITH_FEET, $250, IGNORE, STATE_HANG, &gt;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE_HANG_LEFT, STATE_HANG_RIGHT<BR>
<BR>
This condition could be used to permit a custom animation to jump in fast way over the upper floor. If lara is able to place her feet on the wall she could to push to jump over the up floor, while if she is swinging she will be not able to do.<BR>
<BR>
 <IMG SRC="ExTestPos_SampleG7No.jpg" VSPACE=12 ALIGN="CENTER"><BR>
 <BR>
<BR>
While in this other picture the condition is false because the feet are over the wall and they point in the empty.<BR>
Really above images are not very clear, anyways if you play in that room you can see how the condition becomes YES or NO in according with height of wall where lara is hanged.<BR>
<BR>
<BR>
 <A NAME="LINK48"></A> <BR>
<BR><HR WIDTH=90%><BR><FONT COLOR=#FF0000><CENTER><H2>Trouble shooting</H2></CENTER></FONT>You could type an Animation command with correct ENV condition to start your custom animation but it didn't performe in the wished way.<BR>
This situation could happen for different reasons: a wrong state id set in you custom animation in Animation Editor program, a missing FAN_ flags to prepare the execution of the animation or some collision problem.<BR>
In this chapter I'll try to give some suggestion about most common problems.<BR>
<BR>
 <A NAME="LINK46"></A> <BR>
<FONT COLOR=#FF0080><H3>Issue about State IDs</H3></FONT>In some cirucstances you could have some trouble to perform your animation because of a wrong state-id set in your animation.<BR>
For each State-Id number there is a different portion of code performed in tomb4 engine.<BR>
If you choose a wrong state id, this code could disturb or forbid your animation, pheraps because it could violate some physics rule.<BR>
 <A NAME="LINK47"></A> <BR>
<FONT COLOR=#FF0080><H3>The most common problems</H3></FONT>In according with trouble type, we could find a correct solution.<BR>
We presume you set the correct ENV_ conditions and (further) TestPosition command, and they works fine.<BR>
So, the problem should be while the custom animation should be performed.<BR>
<BR>
You could have the following problems:<BR>
<UL><LI><FONT COLOR=RED> In a jump animation, Lara is not able to cling to climb walls or wall edges.</FONT><BR>
This happens when you forgot to use in Animation command the FAN flag FAN_SET_FREE_HANDS or FAN_SET_FREE_HANDS_TEMP.<BR>
You can solve the problem also typing an animcommand directly in your animation: the [Command3].<BR>
The [Command3] is the animcommand to free the hands of lara.<BR>
If lara holds somewhat, weapons or also a vehicle or a climb wall, an handhold on the edge ect., she is not able to cling to other surface.<BR>
When you perfom a "free hands" command, you say to engine: "I know that lara a moment ago was climing/hanging a wall, but now, with this my animation, she has newly the free hands"<BR>
This command don't remove really the hand's meshes, but simply it assigns to lara the skill to cling newly to somewhat.<BR>
<BR>
<LI><FONT COLOR=RED>The custom animation starts but immediatly it has been interrupted by other default animation.</FONT><BR>
This is the most command situation where the problem is own the state-id.<BR>
You should try to type in State-Id field of Animation Editor, another state-id for your custom animation.<BR>
You can try with state-id 69: full neutral.<BR>
It doesn't disturb your custom animation, but neither it helps her in any way.<BR>
To use this neutral state id you can also use simply the FAN flag named:  FAN_SET_NEUTRAL_STATE_ID in Animation command.<BR>
This method works for "static" animations, i.e. animations where lara move her arms or hands, but she reamins in same position of the level.<BR>
When your animation moves lara, jumping, falling or running, this method cann't work fine, at least to use a (standard) SetPosition animCommand to perform the translation (moving of lara position) of Lara in the animation and at end force the new target coordinates with setposition command.<BR>
If you need to have some help from State id procedures, you can use the state id 89. <BR>
It performs some default computes to manage lara, set byself the "free hands" command, and change the camera mode to watch lara.<BR>
<BR>
Anoter chance is to use the state id 95 or 96, to have default collision and basic management but with very little bans.<BR>
<BR>
As last chance you could select an effective well-known state id, choosing it in according with your custom animation.<BR>
For example if your animation perform a jump, you could use your custom animation only for begin of jump, while for jumping phase you could use a stateid specific for jumps, like: <BR>
<BR>
25 STATE_BACK_JUMP<BR>
3  STATE_FORWARD_JUMP<BR>
27 STATE_LEFT_JUMP<BR>
28 STATE_UP_JUMP<BR>
<BR>
Ect. <BR>
While if your animation is swimming underwater, you could try to set as state id a compatible state id, like: <BR>
<BR>
17 STATE_SWIM<BR>
<BR>
Use [Find] button in Reference panel to find fastly the wished state id. For example for state ids with jumps, you can perform a search with search mask "state jump", or read the State IDs List at bottom of this tutorial<BR>
<BR>
<LI><FONT COLOR=RED>In a jump or falling animation, lara remain still in midair.</FONT><BR>
Probably you need to set the FAN flag FAN_ENABLE_GRAVITY in Animation command, to enable the compute for gravity simulation and intertial horizzontal movement.<BR>
If neither with this flag you solve the problem, then it's a state id issue, too.<BR>
Try to use a state id about jump or falling.<BR>
<BR>
<LI><FONT COLOR=RED>Lara performs correctly your custom animation, but at end, she comes back to starting position.</FONT><BR>
You created an animation where Lara move herself in the space with translation but you forgot to add a SetPosition command to update her position in game.<BR>
<BR>
You can create a static animation, where lara move her legs but she is alwsys in same point of Animation Editor. Then you type a value in [Speed] field of Animation Editor, or you choose a state id for your animation where the engine will move lara for you.<BR>
<BR>
Differently, another method, it's when you move really the dummy of Lara in the animation editor, in this case you translated her position, and to have a correct execution in game, you have to type a standard animcommand for this animation: you type a (standard) SetPosition command, to move the position of lara from its starting position to final position.<BR>
For example if lara in your animation move her for a single sector in forward direction, the setposition command should be:<BR>
SetPosition  [0] [0] [1024]<BR>
And you should read above values in this way:<BR>
At end of animation the origin of lara has to be changed from current position (because lara in the reality had not been moved during your animation but only her meshes had been) to a new position adding to her origin:  +0 to X Pivot, +0 to Y pivot and +1024 (one sector forward) to Z pivot.<BR>
I.e. the syntax is:<BR>
 <BR>
Set Position [+x] [+y] [+z]<BR>
<BR>
Or, said in extended mode:<BR>
<BR>
Set Position [+Right/-Left displacemente] [-Up/+down displacement] [+Forward/-backward displacement]<BR>
<BR>
Give a look to standard animation 42 of lara. It's when she move up a block. You can see the to move up her [-768] (the negative Y move up), and move a bit forward her [128].<BR>
<BR>
<LI><FONT COLOR=RED>At end of your animation the position of Lara is correct but her facing is wrong</FONT><BR>
This happen when your animation should translate the position of lara but also it tries to change her orientaton (facing). I.e. when she in animation rotate herself to look in other diredtion.<BR>
In this case the problem is a missing of SetPosition command: it doesn't permit to change the facing of lara. <BR>
For this reason I added a new flipeffect to change the facing of lara and you should add this ng animcommand to your custom animation.<BR>
The flipeffect is:<BR>
<BR>
"AnimCommand. Turn (facing) current object of <&>degrees in (E)way"<BR>
<BR>
You set above flipeffect in Set Trigger window, and the click on [Export  AnimCommand].<BR>
Type the SetPosition values in your animation and save newly the wad.<BR>
<BR>
<LI><FONT COLOR=RED>I typed the SetPosition for translation and another for turning of facing but yet somewhat doesn't work</FONT><BR>
This situation could happen when lara was in hang position at start of your custom animation.<BR>
For technical reason it's possible that the engine store yet the original position of lara (at start of your animation) and then, at end, it restores it newly.<BR>
To solve this problem you should add another ng animcommand to your animation:<BR>
<BR>
"AnimCommand. Update also original Lara position. (after a SetPosition)"<BR>
<BR>
Export in it as AnimCommand, and type the data in your custom animation.<BR>
<BR>
<LI><FONT COLOR=RED>All works fine except the starting or ending of animation where lara has a rough movement</FONT><BR>
This happen when the starting or ending frame of your animation are not compatible with previous or following default animation of lara.<BR>
<BR>
To solve the problem you should try to reach this target in your animation:<BR>
The first frame of your animarion should have lara in (almost) same position of last frame of previous animation, from what your animation will be started.<BR>
The last frame of your animation should have lara in same position of first frame of next animation, that will be peformed at end of your custom animation and you type in NextAnim field of Animation Editor.<BR>
<BR>
You should open two instances of WadMerger/Animation editor program, and , while with first Animation editor you build your animation, with other Animation editor you should look the frame of some standard animation that will be used first or after your custom animation to normalize the start and final frame with it.<BR>
<BR>
<LI><FONT COLOR=RED>My animation is performed only once while it should be performed continuosly or vice versa</FONT><BR>
This problem regards the loop (or less) mode of your animation.<BR>
Some animations have been created to work in loop mode, i.e. until player hits some key lara will perform continuosly that animation.<BR>
For example the running animation is a looped mode animation.<BR>
Differently other animation work in single-shot mode, like the animation to throw out a flare or to engages a switch.<BR>
Technically the loop or singleshot mode are set from NextAnimation field in AnimationEditor (if nextanim is the same number of current animation it should be a looped animation), and from state id procedure that manages this animation.<BR>
<BR>
About state id it's important the value of NextStateId for lara.<BR>
You cann't set the next state it in animation editor but you can change it dynamically using an exported flipeffect like:<BR>
<BR>
"Lara. (Animation) Force <&>StateID and (E)next StateID for Lara"<BR>
<BR>
or using some FAN flag in Animation script command to force a wished state id or next state id:<BR>
<BR>
FAN_SET_NEUTRAL_STATE_ID  (if you don't want that engine disturbes your animation) But this regard the current state id and you can get same target type the wished value in StateId field in Animation Editor<BR>
<BR>
FAN_KEEP_NEXT_STATEID (if you want that your custom animation was performed only once and then lara comes back to her original animation and state id.)<BR>
<BR>
Remark: if you omit to use FAN_KEEP_NEXT_STATEID the next state id used by lara will be the same you placed in State-Id field of Animation editor for your custom animation.<BR>
Differently, if you use FAN_KEEP_NEXT_STATEID flag, the next state id will be the same foreseen for animation played before starting your custom animation.<BR>
<BR>
If you use FAN_KEEP_NEXT_STATEID in a continuos animation (where NextAnim is the same of current animation) you should add also some Change State id value in your custom animation, using the animation editor.<BR>
A "Change State Id" is a record with values like these:<BR>
<BR>
[StateId] [LowFrame] [HighFrame] [Next Anim] [NextFrame]<BR>
<BR>
The engine when it finds a "Change state id" record in your animation, it uses it in following way:<BR>
<BR>
* Check if the NextStateId of Lara is the same of [StateId] field of "Change State id" record<BR>
* If it is the same, it checks if current frame number of current animation is enclosed in frame range [LowFrame] - [HighRange]<BR>
 *If the frame is in the range, the engine will perform the animation [Next Anim] of "Change State Id" record, and this nex anim animation will be started from [Next Frame] frame. Usually it should be 0 (the first frame) but it could be happen that the first frame is different and own to use a more alike frame from previous animation and this [Next Anim] animation.<BR>
<BR>
If you set the FAN_KEEP_NEXT_STATEID and your custom animation start when lara was in StateId = 2 i.e. STATE_STOP, you should type your record using as [StateId] the value 2, because it will be "2" in NextStateId field of lara while your custom animation was performing, then you should set other value to call in correct frame [Low] - [High] a new animation [NextAnim] to start from  [NextFrame] frame where lara moves from the  current frame of your custom animation until to reach the to stop stand up position, typical of StateId= 2 STATE_STOP.<BR>
You can add more "Change State id" record in your animation, to permits in different frame range or for different nextstateid values to pass to other default animations.<BR>

</UL><BR>
<BR>
 <A NAME="LINK45"></A> <BR>
<FONT COLOR=#FF0080><H3>State IDs List</H3></FONT>This is the full list of state id in default tomb4 exe of The Last Revelation<BR>
<BR>
Remarks:<BR>
<BR>
* The Management procedure is the code used to filter the input game command and to apply many changes of states or animations in according with what lara is doing, and what there is around her (the environment around her).<BR>
<BR>
* The CollisionProcedure theorically should check only for collisions to apply when lara is in that StateId, anyway in many circustances the most of computes happen own in collision procedure.<BR>
<BR>
* The NULL value are missing procedure, pratically the engine doesn't do anything of particular to support that state id type.<BR>
<BR>
* The LARA DEFAULT COL is the default collision procedure. It doesn't perform special checks but only the default verifications to avoid that lara enters in the walls, floors or ceilings.<BR>
<BR>
* The CONTROLLED procedure, verify if lara is performing some specific hardcoded animation and executes furtherly extra operations in according with animation number<BR>
<BR>
* CONTROLLED LET procedure, works like above "COONTROLLED" procedure but in this case it seems works with animation where lara will be translated in other position (with SetPosition standard animcommand).<BR>
There are two CONTROLLED LET state id:  95 (with a limited check for collisions) and 96 with no check for collisions.<BR>
<BR>
* SPECIAL procedure forces only a new camera mode, looking lara from a different position or distance.<BR>
<BR>
* COMPRESS it is simply the preparation phase of some jumps, where lara compress her like a spring and then jump in some direction.<BR>
<BR>
<PRE>  StateId   ManagementProcedure        CollisionProcedure<BR>
----------------------------------------------------------------<BR>
  0 ($00) : WALK                       COLLISION WALK<BR>
  1 ($01) : RUN                        COLLISION RUN<BR>
  2 ($02) : STOP                       COLLISION STOP<BR>
  3 ($03) : FORWARD JUMP               COLLISION FORWARD JUMP<BR>
  4 ($04) : NULL                       COLLISION FAST TURN<BR>
  5 ($05) : FAST BACK                  COLLISION FAST BACK<BR>
  6 ($06) : TURN RIGHT                 COLLISION TURN RIGHT<BR>
  7 ($07) : TURN LEFT                  COLLISION TURN LEFT<BR>
  8 ($08) : DEATH                      COLLISION DEATH<BR>
  9 ($09) : FAST FALL                  COLLISION FAST FALL<BR>
 10 ($0A) : HANG                       COLLISION HANG<BR>
 11 ($0B) : REACH                      COLLISION REACH<BR>
 12 ($0C) : SPLAT                      COLLISION SPLAT<BR>
 13 ($0D) : TREAD                      COLLISION TREAD<BR>
 14 ($0E) : NULL                       COLLISION FAST TURN<BR>
 15 ($0F) : COMPRESS                   COLLISION COMPRESS<BR>
 16 ($10) : BACK                       COLLISION BACK<BR>
 17 ($11) : SWIM                       COLLISION SWIM<BR>
 18 ($12) : GLIDE                      COLLISION GLIDE<BR>
 19 ($13) : NULL                       COLLISION NULL<BR>
 20 ($14) : FAST TURN                  COLLISION FAST TURN<BR>
 21 ($15) : STEP RIGHT                 COLLISION STEP RIGHT<BR>
 22 ($16) : STEP LEFT                  COLLISION STEP LEFT<BR>
 23 ($17) : NULL                       COLLISION ROLL2<BR>
 24 ($18) : SLIDE                      COLLISION SLIDE<BR>
 25 ($19) : BACK JUMP                  COLLISION BACK JUMP<BR>
 26 ($1A) : RIGHT JUMP                 COLLISION RIGHT JUMP<BR>
 27 ($1B) : LEFT JUMP                  COLLISION LEFT JUMP<BR>
 28 ($1C) : UP JUMP                    COLLISION UP JUMP<BR>
 29 ($1D) : FALL BACK                  COLLISION FALL BACK<BR>
 30 ($1E) : HANG LEFT                  COLLISION HANG LEFT<BR>
 31 ($1F) : HANG RIGHT                 COLLISION HANG RIGHT<BR>
 32 ($20) : SLIDE BACK                 COLLISION SLIDE BACK<BR>
 33 ($21) : SURF TREAD                 COLLISION SURF TREAD<BR>
 34 ($22) : SURF SWIM                  COLLISION SURF SWIM<BR>
 35 ($23) : DIVE                       COLLISION DIVE<BR>
 36 ($24) : PUSH BLOCK                 COLLISION NULL<BR>
 37 ($25) : PULL BLOCK                 COLLISION NULL<BR>
 38 ($26) : PUSH PULL READY            COLLISION NULL<BR>
 39 ($27) : PICK UP                    COLLISION NULL<BR>
 40 ($28) : SWITCH ON                  COLLISION NULL<BR>
 41 ($29) : SWITCH ON                  COLLISION NULL<BR>
 42 ($2A) : USE KEY                    COLLISION NULL<BR>
 43 ($2B) : USE PUZZLE                 COLLISION NULL<BR>
 44 ($2C) : UNDERWATER DEATH           COLLISION UNDERWATER DEATH<BR>
 45 ($2D) : NULL                       COLLISION ROLL<BR>
 46 ($2E) : SPECIAL                    NULL<BR>
 47 ($2F) : SURF BACK                  COLLISION SURF BACK<BR>
 48 ($30) : SURF LEFT                  COLLISION SURF LEFT<BR>
 49 ($31) : SURF RIGHT                 COLLISION SURF RIGHT<BR>
 50 ($32) : NULL                       NULL<BR>
 51 ($33) : NULL                       NULL<BR>
 52 ($34) : SWAN DIVE                  COLLISION SWAN DIVE<BR>
 53 ($35) : FAST DIVE                  COLLISION FAST DIVE<BR>
 54 ($36) : NULL                       COLLISION NULL<BR>
 55 ($37) : WATER OUT                  COLLISION NULL<BR>
 56 ($38) : CLIMB START_AND_STANDING   COLLISION CLIMB START AND STANDING<BR>
 57 ($39) : CLIMB UP                   COLLISION CLIMB UP<BR>
 58 ($3A) : CLIMB LEFT                 COLLISION CLIMB LEFT<BR>
 59 ($3B) : CLIMB END                  NULL<BR>
 60 ($3C) : CLIMB RIGHT                COLLISION CLIMB RIGHT<BR>
 61 ($3D) : CLIMB DOWN                 COLLISION CLIMB DOWN<BR>
 62 ($3E) : NULL                       NULL<BR>
 63 ($3F) : NULL                       NULL<BR>
 64 ($40) : NULL                       NULL<BR>
 65 ($41) : WADE                       COLLISION WADE<BR>
 66 ($42) : WATER ROLL                 COLLISION WATER ROLL<BR>
 67 ($43) : PICK UP FLARE              COLLISION NULL<BR>
 68 ($44) : NULL                       NULL<BR>
 69 ($45) : NULL                       NULL<BR>
 70 ($46) : DEATH SLIDE                NULL<BR>
 71 ($47) : DUCK                       COLLISION DUCK<BR>
 72 ($48) : DUCK                       COLLISION DUCK<BR>
 73 ($49) : DASH                       COLLISION DASH<BR>
 74 ($4A) : DASH DIVE                  COLLISION DASH DIVE<BR>
 75 ($4B) : MONKEY_STILL_OR_HANG_SWING COLLISION MONKEY_STILL_OR_HANG_SWING<BR>
 76 ($4C) : MONKEY SWING               COLLISION MONKEY SWING<BR>
 77 ($4D) : MONKEY LEFT                COLLISION MONKEY LEFT<BR>
 78 ($4E) : MONKEY RIGHT               COLLISION MONKEY RIGHT<BR>
 79 ($4F) : MONKEY 180                 COLLISION MONKEY 180<BR>
 80 ($50) : ON ALL FOURS STANDING      COLLISION ON ALL FOURS STANDING<BR>
 81 ($51) : ON ALL FOURS FORWARD       COLLISION ON ALL FOURS FORWARD<BR>
 82 ($52) : HANG TURN LEFT             COLLISION HANG TURN LEFT RIGHT<BR>
 83 ($53) : HANG TURN RIGHT            COLLISION HANG TURN LEFT RIGHT<BR>
 84 ($54) : ON ALL FOURS TURN LEFT     COLLISION ON ALL FOURS TURN LEFT RIGHT<BR>
 85 ($55) : ON ALL FOURS TURN RIGHT    COLLISION ON ALL FOURS TURN LEFT RIGHT<BR>
 86 ($56) : ON ALL FOURS BACK          COLLISION ON ALL FOURS TURN LEFT RIGHT BACK<BR>
 87 ($57) : NULL                       NULL<BR>
 88 ($58) : NULL                       COLLISION ON ALL FOURS TURN LEFT RIGHT TO HANG<BR>
 89 ($59) : CONTROLLED                 LARA DEFAULT COL<BR>
 90 ($5A) : ROPE LEFT                  NULL<BR>
 91 ($5B) : ROPE RIGHT                 NULL<BR>
 92 ($5C) : CONTROLLED                 LARA DEFAULT COL<BR>
 93 ($5D) : CONTROLLED                 NULL<BR>
 94 ($5E) : CONTROLLED                 NULL<BR>
 95 ($5F) : CONTROLLED LET             COLLISION TURN SWITCH<BR>
 96 ($60) : CONTROLLED LET             NULL<BR>
 97 ($61) : CONTROLLED                 NULL<BR>
 98 ($62) : PICK UP                    COLLISION NULL<BR>
 99 ($63) : NULL                       COLLISION POLE STATIC<BR>
100 ($64) : NULL                       COLLISION POLE UP<BR>
101 ($65) : NULL                       COLLISION POLE DOWN<BR>
102 ($66) : POLE LEFT                  NULL<BR>
103 ($67) : POLE RIGHT                 NULL<BR>
104 ($68) : PULLEY                     LARA DEFAULT COL<BR>
105 ($69) : DUCK LEFT                  COLLISION DUCK LEFT RIGHT<BR>
106 ($6A) : DUCK RIGHT                 COLLISION DUCK LEFT RIGHT<BR>
107 ($6B) : EXTERNAL CORNER LEFT       LARA DEFAULT COL<BR>
108 ($6C) : EXTERNAL CORNER RIGHT      LARA DEFAULT COL<BR>
109 ($6D) : INTERNAL CORNER LEFT       LARA DEFAULT COL<BR>
110 ($6E) : INTERNAL CORNER RIGHT      LARA DEFAULT COL<BR>
111 ($6F) : ROPE                       COLLISION ROPE<BR>
112 ($70) : ROPE CLIMB UP              NULL<BR>
113 ($71) : ROPE CLIMB DOWN            NULL<BR>
114 ($72) : ROPE                       COLLISION ROPE FORWARD<BR>
115 ($73) : ROPE                       COLLISION ROPE FORWARD<BR>
116 ($74) : NULL                       NULL<BR>
117 ($75) : CONTROLLED                 NULL<BR>
----------------------------------------------------------------<BR>
</PRE</B></BODY></HTML>
